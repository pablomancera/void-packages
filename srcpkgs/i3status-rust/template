# Template file for 'i3status-rust'
pkgname=i3status-rust
version=0.32.2
revision=1
build_style=cargo
configure_args="$(vopt_if notmuch '--features notmuch')"
make_check_args="--bins"
hostmakedepends="pkg-config $(vopt_if docs pandoc)"
makedepends="pulseaudio-devel openssl-devel libsensors-devel
	$(vopt_if notmuch libnotmuch-devel)"
short_desc="Replacement for i3status, written in Rust"
maintainer="Jan Christian Gr√ºnhage <jan.christian@gruenhage.xyz>"
license="GPL-3.0-only"
homepage="https://github.com/greshake/i3status-rust"
changelog="https://raw.githubusercontent.com/greshake/i3status-rust/master/NEWS.md"
distfiles="https://github.com/greshake/i3status-rust/archive/refs/tags/v${version}.tar.gz"
checksum=8957424ecc0aad778784c3c1ac1051b8ceee22903ed1d292deed732a486130de

build_options="notmuch docs"
build_options_default="docs"
desc_option_notmuch="Required for optional notmuch block"
desc_option_docs="Generate manpage"

if [ "$CROSS_BUILD" ] && [ "$build_option_docs" ]; then
	hostmakedepends+=" pulseaudio-devel openssl-devel libsensors-devel"
fi

post_build() {
	if [ "$build_option_docs" ]; then
		env -i bash -c "source /etc/profile && cargo xtask generate-manpage"
	fi
}

post_install() {
	vmkdir usr/share/i3status-rust
	vcopy files/* usr/share/i3status-rust/

	if [ "$build_option_docs" ]; then
		vman man/i3status-rs.1
	fi
}
